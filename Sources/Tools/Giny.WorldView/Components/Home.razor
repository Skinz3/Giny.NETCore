@page "/home"


@using Giny.WorldView.Components.Spells
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web.Virtualization
@using MudBlazor
@using Giny.World.Records.Spells;

@inherits LayoutComponentBase
@inject NavigationManager UriHelper
@inject IDialogService DialogService

@page "/"

<MudThemeProvider @bind-IsDarkMode="@DarkMode" />
<MudDialogProvider />
<MudSnackbarProvider />



<MudLayout>


    <MudPaper Elevation="1">

        <MudToolBar>
            <MudIconButton OnClick="@ToggleDrawer" Icon="@Icons.Material.Outlined.Menu" Color="Color.Inherit" Class="mr-5" />
            <MudIconButton Icon="@Icons.Material.Outlined.Add" />
            <MudIconButton Icon="@Icons.Material.Outlined.Edit" />
            <MudIconButton Icon="@Icons.Material.Outlined.Remove" Color="Color.Inherit" />
            <MudIconButton OnClick="()=> Navigate(PageEnum.Configuration)" Icon="@Icons.Material.Outlined.Settings" Color="Color.Inherit" />
            <MudSpacer />
            <MudToggleIconButton @bind-Toggled=@DarkMode
                                 Icon="@Icons.Filled.LightMode" Title="Off"
                                 ToggledIcon="@Icons.Filled.DarkMode" ToggledTitle="On" />


            <MudIconButton Icon="@Icons.Material.Outlined.Notifications" />
            <MudIconButton Icon="@Icons.Material.Outlined.PushPin" />
            <MudIconButton Icon="@Icons.Material.Outlined.PeopleAlt" />

            <MudIconButton Icon="@Icons.Material.Outlined.MoreVert" Color="Color.Inherit" />
        </MudToolBar>
        <MudDrawer @bind-Open="@DrawerOpen" Elevation="1">
            <MudDrawerHeader>
                <MudText Typo="Typo.h3">Giny</MudText>

            </MudDrawerHeader>
            <MudNavMenu>
                <MudTreeView T="string">
                    <MudTreeViewItem Icon="@Icons.Outlined.FilterDrama" Value="@("Serveur")">
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.SpellExplorer)" Match="NavLinkMatch.All">Sorts</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.EffectsRelator)" Match="NavLinkMatch.All">Sorts par effets</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.TriggersRelator)" Match="NavLinkMatch.All">Sorts par triggers</MudNavLink>


                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.Dungeons)" Match="NavLinkMatch.All">Donjons</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.Items)" Match="NavLinkMatch.All">Objets</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.Npcs)" Match="NavLinkMatch.All">PNJ's</MudNavLink>
                    </MudTreeViewItem>
                    <MudTreeViewItem Icon="@Icons.Outlined.Computer" Value="@("Client")">
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.D2O)" Match="NavLinkMatch.All">D2O</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.D2I)" Match="NavLinkMatch.All">D2I</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.D2P)" Match="NavLinkMatch.All">D2P</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.SWL)" Match="NavLinkMatch.All">SWL</MudNavLink>
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.MapEditor)" Match="NavLinkMatch.All">MapEditor</MudNavLink>
                    </MudTreeViewItem>

                    <MudTreeViewItem Icon="@Icons.Material.Outlined.Settings" Value="@("Parametres")">
                        <MudNavLink Icon="@Icons.Outlined.ArrowRight" OnClick="() => Navigate(PageEnum.Configuration)" Match="NavLinkMatch.All">Données</MudNavLink>
                    </MudTreeViewItem>

                </MudTreeView>


            </MudNavMenu>
        </MudDrawer>
    </MudPaper>

    <MudMainContent Class="pa-4 mr-0">
        <CascadingValue Value="this">

            @if (AppState.Page == PageEnum.Loader)
            {
                <Loader></Loader>
            }
            else if (AppState.Page == PageEnum.SpellExplorer)
            {
                <SpellExplorer></SpellExplorer>
            }
            else if (AppState.Page == PageEnum.EffectsRelator)
            {
                <EffectsRelator></EffectsRelator>
            }
            else if (AppState.Page == PageEnum.TriggersRelator)
            {
                <TriggersRelator></TriggersRelator>
            }
            else if (AppState.Page == PageEnum.Items)
            {
                <Items></Items>
            }
            else if (AppState.Page == PageEnum.D2O)
            {
                <D2O></D2O>
            }
            else if (AppState.Page == PageEnum.Dungeons)
            {
                <Dungeons></Dungeons>
            }
            else if (AppState.Page == PageEnum.Configuration)
            {
                <Configuration></Configuration>
            }
        </CascadingValue>

    </MudMainContent>
</MudLayout>


@code {

    private bool DarkMode
    {
        get;
        set;
    }

    bool DrawerOpen
    {
        get;
        set;
    } = true;

    public void Navigate(PageEnum page)
    {
        if (!AppState.Initialized)
        {
            DialogService.ShowMessageBox("Chargement en cours", "Veuillez attendre la fin du chargement de l'application.");
            return;
        }
        AppState.Page = page;
        StateHasChanged();
    }


    void ToggleDrawer()
    {
        DrawerOpen = !DrawerOpen;
    }
}

