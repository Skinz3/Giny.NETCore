@using Giny.Protocol.Enums
@using Giny.World.Managers.Effects
@using Giny.World.Records.Monsters
@using Giny.World.Records.Spells
@using Microsoft.AspNetCore.Components.Web.Virtualization


<MudGrid>
    <MudItem xs="3">
        <MudPaper Outlined=true>
            <MudList Color="Color.Primary" Dense="true" Clickable="true">
                <MudListSubheader>
                    <MudTextField Label="Search" TextChanged=OnSearchTextChanged @bind-Value="@Search"
                                  AdornmentColor="Color.Primary" AdornmentIcon="@Icons.Filled.Search"
                                  Adornment="Adornment.End" Immediate="true" Variant="Variant.Outlined" />
                </MudListSubheader>

                <div style="height:80vh;overflow-y:scroll">
                    <Virtualize Items="@SearchResults">

                        <MudListItem OnClick="() => spellComponent.SelectSpell(context)" Value="context">

                            <div class="d-flex flex-row gap-3 align-center">
                                <MudIcon Icon="@Icons.Outlined.Workspaces" />
                                <div class="d-flex flex-column">
                                    <MudText Style="font-size:14px;line-height:16px;font-weight:600;">@context.Name</MudText>
                                    <MudText Typo=Typo.caption Style="line-height:16px">@(string.IsNullOrWhiteSpace(context.Description) ? "" : context.Description)</MudText>

                                </div>
                            </div>

                        </MudListItem>


                    </Virtualize>
                </div>

            </MudList>

        </MudPaper>

    </MudItem>

    <MudItem xs="9">
        <SpellComponent @ref="spellComponent"></SpellComponent>
    </MudItem>


</MudGrid>


@code {

    [Inject]
    private IDialogService DialogService
    {
        get;
        set;
    }

    private List<SpellRecord> SearchResults
    {
        get;
        set;
    } = new List<SpellRecord>();

    private string Search
    {
        get;
        set;
    } = "";

    private SpellComponent? spellComponent;

    private void OnSearchTextChanged()
    {
        SearchResults = SpellRecord.GetSpellRecords().Where(x => x.ToString().ToLower().Contains(Search.ToLower())).ToList();

        StateHasChanged();
    }
    protected override void OnAfterRender(bool firstRender)
    {

    }


}